FUNCTION NPREROC(N, NB, IPROC, ISRCPROC, NPROCS) RESULT(NPREROCresult)
    INTEGER, INTENT(IN) :: N, NB, IPROC, ISRCPROC, NPROCS
    INTEGER :: NPREROCresult, EXTRABLKS, MYDIST, NBLOCKS, MYROWS

    MYDIST = MOD(NPROCS + IPROC - ISRCPROC, NPROCS)
    NBLOCKS = N / NB
    MYROWS = (NBLOCKS / NPROCS) * NB
    EXTRABLKS = MOD(NBLOCKS, NPROCS)

    IF (MYDIST < EXTRABLKS) THEN
        MYROWS = MYROWS + NB
    ELSEIF (MYDIST == EXTRABLKS) THEN
        MYROWS = MYROWS + MOD(N, NB)
    END IF

    NPREROCresult = MYROWS
END FUNCTION NPREROC

PROGRAM testNPREROC
    PRINT *, "Test 1: Expected 250, Got ", NPREROC(1000, 10, 1, 0, 4)
    PRINT *, "Test 2: Expected 20, Got ", NPREROC(100, 20, 1, 1, 5)
END PROGRAM testNPREROC