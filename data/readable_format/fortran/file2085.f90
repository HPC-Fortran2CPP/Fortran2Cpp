PROGRAM TestSide2
  IMPLICIT NONE
  REAL, ALLOCATABLE :: A_IN(:), SD_A_IN(:)
  INTEGER, ALLOCATABLE :: IX_FOUND(:)
  INTEGER :: NX, IX, POINTS_FOUND, MAX_SEARCH_RADIUS, MAX_VALUES_PER_SIDE
  REAL :: BADDATA
  INTEGER :: i

  ! Initialize variables and allocate arrays
  NX = 5
  BADDATA = -999.0
  ALLOCATE(A_IN(NX), SD_A_IN(NX), IX_FOUND(NX))
  IX = 1
  MAX_SEARCH_RADIUS = 4
  MAX_VALUES_PER_SIDE = 2

  ! Test 1: All elements are BADDATA
  A_IN = BADDATA
  SD_A_IN = BADDATA
  CALL SIDE2(A_IN, SD_A_IN, NX, BADDATA, MAX_SEARCH_RADIUS, MAX_VALUES_PER_SIDE, IX, POINTS_FOUND, IX_FOUND)
  PRINT *, "Test 1: Points found = ", POINTS_FOUND

  ! Test 2: Some elements match, less than MAX_VALUES_PER_SIDE
  A_IN = (/BADDATA, 1.0, BADDATA, 2.0, BADDATA/)
  SD_A_IN = A_IN
  CALL SIDE2(A_IN, SD_A_IN, NX, BADDATA, MAX_SEARCH_RADIUS, MAX_VALUES_PER_SIDE, IX, POINTS_FOUND, IX_FOUND)
  PRINT *, "Test 2: Points found = ", POINTS_FOUND
  DO i=1,POINTS_FOUND
    PRINT *, "Index found: ", IX_FOUND(i)
  END DO

  ! Continue with other tests as needed...

  DEALLOCATE(A_IN, SD_A_IN, IX_FOUND)
END PROGRAM TestSide2

SUBROUTINE SIDE2(A_IN, SD_A_IN, NX, BADDATA, MAX_SEARCH_RADIUS, MAX_VALUES_PER_SIDE, IX, POINTS_FOUND, IX_FOUND)
  IMPLICIT NONE
  INTEGER NX, IX, IX_SEARCH, POINTS_FOUND, MAX_SEARCH_RADIUS, MAX_VALUES_PER_SIDE
  INTEGER IX_FOUND(1)
  REAL BADDATA
  REAL A_IN(NX), SD_A_IN(NX)

  POINTS_FOUND=0
  DO 1 IX_SEARCH=IX+1,IX+MAX_SEARCH_RADIUS
     IF(IX_SEARCH.GT.NX)THEN
        EXIT
     ENDIF
     IF(A_IN(IX_SEARCH).NE.BADDATA.AND.SD_A_IN(IX_SEARCH).NE.BADDATA)THEN
        POINTS_FOUND=POINTS_FOUND+1
        IX_FOUND(POINTS_FOUND)=IX_SEARCH
        IF(POINTS_FOUND.GE.MAX_VALUES_PER_SIDE)THEN
           RETURN
        ENDIF
     ENDIF
1  CONTINUE
END SUBROUTINE SIDE2